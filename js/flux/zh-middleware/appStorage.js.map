{"version":3,"sources":["../../../src/flux/zh-middleware/appStorage.js"],"names":["appStorage","getState","dispatch","next","action","type","ACTION","SAVE_BOARD","window","localStorage","setItem","CONF","STORAGE_KEY","JSON","stringify","drawerMsg","modal","id","data","dma","addDrawerMsg","MSG_SAVED","e","MSG_SAVE_FAIL","console","log","msg","CLEAN_STORAGE","removeItem","MSG_CLEANED","MSG_CLEAN_FAIL"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,UAAU,GAAG,SAAbA,UAAa;AAAA,MAAGC,QAAH,QAAGA,QAAH;AAAA,MAAaC,QAAb,QAAaA,QAAb;AAAA,SAA4B,UAAAC,IAAI;AAAA,WAAI,UAAAC,MAAM,EAAI;AAC/D,cAAOA,MAAM,CAACC,IAAd;AACE,aAAKC,gBAAOC,UAAZ;AAAwB;AACtB,gBAAI;AACFC,cAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CACEC,oBAAKC,WADP,EAEEC,IAAI,CAACC,SAAL,+BACKb,QAAQ,EADb;AAEEc,gBAAAA,SAAS,EAAE,EAFb;AAGEC,gBAAAA,KAAK,EAAE;AAAEC,kBAAAA,EAAE,EAAE,IAAN;AAAYC,kBAAAA,IAAI,EAAE;AAAlB;AAHT,iBAFF;AAQAhB,cAAAA,QAAQ,CACNiB,qBAAIC,YAAJ,CAAiBT,oBAAKU,SAAtB,CADM,CAAR;AAGA,qBAAO,IAAP;AACD,aAbD,CAaE,OAAMC,CAAN,EAAS;AACTpB,cAAAA,QAAQ,CACNiB,qBAAIC,YAAJ,CAAiBT,oBAAKY,aAAtB,CADM,CAAR;AAGAC,cAAAA,OAAO,CAACC,GAAR,CAAYH,CAAC,CAACI,GAAd;AACA,qBAAO,KAAP;AACD;AACF;;AACD,aAAKpB,gBAAOqB,aAAZ;AAA2B;AACzB,gBAAI;AACFnB,cAAAA,MAAM,CAACC,YAAP,CAAoBmB,UAApB,CAA+BjB,oBAAKC,WAApC;AACAV,cAAAA,QAAQ,CACNiB,qBAAIC,YAAJ,CAAiBT,oBAAKkB,WAAtB,CADM,CAAR;AAGA,qBAAO,IAAP;AACD,aAND,CAME,OAAMP,CAAN,EAAQ;AACRpB,cAAAA,QAAQ,CACNiB,qBAAIC,YAAJ,CAAiBT,oBAAKmB,cAAtB,CADM,CAAR;AAGAN,cAAAA,OAAO,CAACC,GAAR,CAAYH,CAAC,CAACI,GAAd;AACA,qBAAO,KAAP;AACD;AACF;;AACD;AAAS,iBAAOvB,IAAI,CAACC,MAAD,CAAX;AAtCX;AAwCD,KAzCkD;AAAA,GAAhC;AAAA,CAAnB;;eA2CeJ,U","sourcesContent":["import { ACTION } from '../app/actions'\r\nimport dma from '../drawerMsg/actions'\r\nimport CONF from '../appConf'\r\n\r\nconst appStorage = ({ getState, dispatch }) => next => action => {\r\n  switch(action.type){\r\n    case ACTION.SAVE_BOARD: {\r\n      try {\r\n        window.localStorage.setItem(\r\n          CONF.STORAGE_KEY,\r\n          JSON.stringify({\r\n            ...getState(),\r\n            drawerMsg: [],\r\n            modal: { id: null, data: null }\r\n          })\r\n        )\r\n        dispatch(\r\n          dma.addDrawerMsg(CONF.MSG_SAVED)\r\n        )\r\n        return true;\r\n      } catch(e) {\r\n        dispatch(\r\n          dma.addDrawerMsg(CONF.MSG_SAVE_FAIL)\r\n        )\r\n        console.log(e.msg)\r\n        return false;\r\n      }\r\n    }\r\n    case ACTION.CLEAN_STORAGE: {\r\n      try {\r\n        window.localStorage.removeItem(CONF.STORAGE_KEY)\r\n        dispatch(\r\n          dma.addDrawerMsg(CONF.MSG_CLEANED)\r\n        )\r\n        return true;\r\n      } catch(e){\r\n        dispatch(\r\n          dma.addDrawerMsg(CONF.MSG_CLEAN_FAIL)\r\n        )\r\n        console.log(e.msg)\r\n        return false;\r\n      }\r\n    }\r\n    default: return next(action);\r\n  }\r\n};\r\n\r\nexport default appStorage\r\n"],"file":"appStorage.js"}