{"version":3,"file":"noteLabelId.js","names":["_isArr","Array","isArray","_isObj","v","_fIsLabel","item","_","title","color","_crLabels","hmLabel","labels","labelsTo","newLabels","_arrLabels","crArrFormHm","forEach","id","push","_label","find","crId","CONF","NLABELS_PREFIX","noteLabelIdMiddleware","getState","dispatch","next","action","type","editNoteLabels","hmLabels","sNoteLabel","payload"],"sources":["../../../src/flux/zh-middleware/noteLabelId.js"],"sourcesContent":["import { editNoteLabels } from '../note/actions';\r\nimport { sNoteLabel } from '../selectors';\r\nimport crArrFormHm from '../../utils/crArrFromHm';\r\nimport crId from './crId';\r\nimport CONF from '../appConf';\r\n\r\nconst _isArr = Array.isArray\r\n, _isObj = v => v && typeof v === 'object';\r\n\r\nconst _fIsLabel = (item) => _ =>\r\n  _.title === item.title\r\n  && _.color === item.color;\r\n\r\nconst _crLabels = (\r\n  hmLabel,\r\n  labels\r\n) => {\r\n   const labelsTo = []\r\n   , newLabels = [];\r\n\r\n   if (!_isObj(hmLabel) || !_isArr(labels)) {\r\n     return {\r\n       labelsTo,\r\n       newLabels\r\n     };\r\n   }\r\n\r\n   const _arrLabels = crArrFormHm(hmLabel);\r\n   labels.forEach(item => {\r\n      if (item.id) {\r\n        labelsTo.push(item)\r\n      } else {\r\n        const _label = _arrLabels\r\n          .find(_fIsLabel(item));\r\n        if (!_label) {\r\n          item.id = crId(CONF.NLABELS_PREFIX)\r\n          labelsTo.push(item)\r\n          newLabels.push(item)\r\n        } else {\r\n          item.id = _label.id\r\n          labelsTo.push(item)\r\n        }\r\n      }\r\n   })\r\n   return {\r\n     labelsTo,\r\n     newLabels\r\n   };\r\n};\r\n\r\nconst noteLabelIdMiddleware = ({\r\n  getState,\r\n  dispatch\r\n}) => next => action => {\r\n  if (action.type === editNoteLabels.type) {\r\n    const hmLabels = sNoteLabel.labels(getState())\r\n    , { payload } = action;\r\n    action.payload = {\r\n      ...payload,\r\n      ..._crLabels(hmLabels, payload.labels)\r\n    }\r\n  }\r\n  return next(action);\r\n}\r\n\r\nexport default noteLabelIdMiddleware\r\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAMA,MAAM,GAAGC,KAAK,CAACC,OAArB;AAAA,IACEC,MAAM,GAAG,SAATA,MAAS,CAAAC,CAAC;EAAA,OAAIA,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAtB;AAAA,CADZ;;AAGA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,IAAD;EAAA,OAAU,UAAAC,CAAC;IAAA,OAC3BA,CAAC,CAACC,KAAF,KAAYF,IAAI,CAACE,KAAjB,IACGD,CAAC,CAACE,KAAF,KAAYH,IAAI,CAACG,KAFO;EAAA,CAAX;AAAA,CAAlB;;AAIA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAChBC,OADgB,EAEhBC,MAFgB,EAGb;EACF,IAAMC,QAAQ,GAAG,EAAjB;EAAA,IACEC,SAAS,GAAG,EADd;;EAGA,IAAI,CAACX,MAAM,CAACQ,OAAD,CAAP,IAAoB,CAACX,MAAM,CAACY,MAAD,CAA/B,EAAyC;IACvC,OAAO;MACLC,QAAQ,EAARA,QADK;MAELC,SAAS,EAATA;IAFK,CAAP;EAID;;EAED,IAAMC,UAAU,GAAG,IAAAC,uBAAA,EAAYL,OAAZ,CAAnB;;EACAC,MAAM,CAACK,OAAP,CAAe,UAAAX,IAAI,EAAI;IACpB,IAAIA,IAAI,CAACY,EAAT,EAAa;MACXL,QAAQ,CAACM,IAAT,CAAcb,IAAd;IACD,CAFD,MAEO;MACL,IAAMc,MAAM,GAAGL,UAAU,CACtBM,IADY,CACPhB,SAAS,CAACC,IAAD,CADF,CAAf;;MAEA,IAAI,CAACc,MAAL,EAAa;QACXd,IAAI,CAACY,EAAL,GAAU,IAAAI,gBAAA,EAAKC,mBAAA,CAAKC,cAAV,CAAV;QACAX,QAAQ,CAACM,IAAT,CAAcb,IAAd;QACAQ,SAAS,CAACK,IAAV,CAAeb,IAAf;MACD,CAJD,MAIO;QACLA,IAAI,CAACY,EAAL,GAAUE,MAAM,CAACF,EAAjB;QACAL,QAAQ,CAACM,IAAT,CAAcb,IAAd;MACD;IACF;EACH,CAfD;EAgBA,OAAO;IACLO,QAAQ,EAARA,QADK;IAELC,SAAS,EAATA;EAFK,CAAP;AAIF,CAnCD;;AAqCA,IAAMW,qBAAqB,GAAG,SAAxBA,qBAAwB;EAAA,IAC5BC,QAD4B,QAC5BA,QAD4B;EAAA,IAE5BC,QAF4B,QAE5BA,QAF4B;EAAA,OAGxB,UAAAC,IAAI;IAAA,OAAI,UAAAC,MAAM,EAAI;MACtB,IAAIA,MAAM,CAACC,IAAP,KAAgBC,uBAAA,CAAeD,IAAnC,EAAyC;QACjC,IAAAE,QAAQ,GAAGC,qBAAA,CAAWrB,MAAX,CAAkBc,QAAQ,EAA1B,CAAX;QAAA,IACFQ,OADE,GACUL,MADV,CACFK,OADE;;QAENL,MAAM,CAACK,OAAP,iCACKA,OADL,EAEKxB,SAAS,CAACsB,QAAD,EAAWE,OAAO,CAACtB,MAAnB,CAFd;MAID;;MACD,OAAOgB,IAAI,CAACC,MAAD,CAAX;IACD,CAVS;EAAA,CAHoB;AAAA,CAA9B;;eAeeJ,qB"}